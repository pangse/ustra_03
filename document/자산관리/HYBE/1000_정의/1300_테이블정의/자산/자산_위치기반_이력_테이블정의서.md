````md
# 문서명: ZFI_ASSET_POSITION_LOG_테이블정의서.md
- 작성일: 2025-05-23
- 작성자: 송영근
- 내  용: RFID, GPS, BLE 기반 자산 위치 변화 이력을 기록하고, 자동 이동 로그 및 위치 추적 기능을 지원하는 위치기반 이력 테이블 정의서

---

## [1. 테이블명 및 목적]

- 테이블명: `ZFI_ASSET_POSITION_LOG`
- 목적: 자산의 물리적 위치가 RFID, GPS, BLE 등의 기술을 통해 감지되었을 때  
        자동으로 이력을 기록하여 실시간 위치 추적, 자동 이동 감지, 보안 경고 기능의 기반 정보를 제공함

---

## [2. 테이블 구조 (Prisma 기준)]

```prisma
model ZFI_ASSET_POSITION_LOG {
  id             String   @id @default(uuid())    // 고유 로그 ID
  assetId        String                             // 자산 ID (ZFI_ASSET_MASTER.id)
  method         String                             // 위치 감지 방식 (RFID, GPS, BLE)
  position       String                             // 위치 값 (코드명 또는 좌표)
  status         String                             // 상태 (ENTERED, EXITED, STAY)
  signalStrength Float?                             // 신호 세기 (BLE/RFID의 경우)
  latitude       Float?                             // 위도 (GPS 전용)
  longitude      Float?                             // 경도 (GPS 전용)
  accuracy       Float?                             // 정확도 (GPS 전용)
  loggedAt       String                             // 감지 시각
  createdAt      String
}
````

---

## \[3. 연관 테이블 관계]

| 필드       | 참조 테이블                                  | 설명           |
| -------- | --------------------------------------- | ------------ |
| assetId  | `ZFI_ASSET_MASTER`                      | 위치를 추적할 자산   |
| method   | `ZCM_CODE_VALUE (POSITION_METHOD)`      | 감지 방식 코드화 가능 |
| position | `ZCM_CODE_VALUE (LOCATION)` 또는 GPS 직접입력 | 위치 기준        |

---

## \[4. 예시 데이터]

| assetId | method | position             | status  | loggedAt             |
| ------- | ------ | -------------------- | ------- | -------------------- |
| A001    | RFID   | GATE\_01             | ENTERED | 2025-05-23T10:00:00Z |
| A001    | RFID   | GATE\_01             | EXITED  | 2025-05-23T10:05:00Z |
| A002    | GPS    | (37.1234, 127.5678)  | STAY    | 2025-05-23T10:03:00Z |
| A003    | BLE    | BEACON\_WAREHOUSE\_A | ENTERED | 2025-05-23T10:06:00Z |

---

## \[5. 활용 시나리오]

* 자산이 창고에서 출고될 때 자동으로 로그 기록
* GPS 기반 실외 자산 위치 추적
* BLE 기준 실내 근접 감지 (예: 대기실 진입)
* 이동 시간 자동 측정 및 이동 패턴 분석

---

## \[6. 관리 기준]

* 로그는 수정/삭제 불가, 오직 추가만 가능 (감사 기준)
* GPS 좌표는 소수점 6자리까지 저장 권장
* 동일 `position` 반복 기록은 일정 시간 간격 내 중복 방지 필요 (예: 1분 이내)

---

## \[7. 확장 고려 사항]

* `assetStatus` 자동 변경 연계 (`position = EXIT_GATE` → `RENTED`)
* 위치 이상 탐지 시 자동 알림 트리거 가능
* 위치 기반 KPI 측정 가능 (위치별 체류 시간, 회전율)

---

```
```
