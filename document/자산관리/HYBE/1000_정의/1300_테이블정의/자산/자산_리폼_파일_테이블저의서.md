# 문서명: ZFI_ASSET_REFORM_테이블정의서.md (확장 확정본 - SAP 연동 제외)
- 수정일: 2025-05-23
- 작성자: 송영근
- 내  용: 자산 리폼 처리 시 기존 자산과 신규 자산 간의 연계, 리폼 사유·유형, 비용, 외부 업체, 첨부파일 정보, 결과물 이미지까지 포함하여 자산관리 시스템 내 완결된 리폼 이력을 관리하는 확장형 정의서

---

## [1. 테이블명 및 목적]

- 테이블명: `ZFI_ASSET_REFORM`
- 목적: 기존 자산을 리폼하여 신규 자산으로 전환하는 업무 흐름을 추적하기 위한  
  리폼 이력 테이블로, 사유, 유형, 담당조직, 비용, 외부 업체, 첨부파일, 이미지 등  
  리폼과 관련된 모든 구조를 기록하고 리폼 자산 전환의 정합성과 이력을 보장함

---

## [2. 테이블 구조 (Prisma 기준)]

```prisma
model ZFI_ASSET_REFORM {
  id              String   @id @default(uuid())
  sourceAssetId   String                              // 기존 자산 ID
  newAssetId      String                              // 신규 자산 ID
  orgId           String                              // 처리 조직 ID
  reformDate      String                              // 리폼 완료일
  reformReason    String                              // 리폼 사유 코드 (공통코드)
  reformType      String                              // 리폼 유형 코드 (공통코드)
  reformDetails   String?                             // 리폼 상세 설명
  cost            Float?                              // 리폼 비용
  vendorId        String?                             // 외부 처리 업체 ID
  imageUrl        String?                             // 결과 이미지 경로 (썸네일)
  createdBy       String
  createdAt       String
  updatedBy       String?
  updatedAt       String?

  attachments     ZFI_ASSET_REFORM_FILE[]
  vendor          ZFI_VENDOR? @relation(fields: [vendorId], references: [vendorId])
}
````

---

## \[3. 첨부파일 테이블: `ZFI_ASSET_REFORM_FILE`]

```prisma
model ZFI_ASSET_REFORM_FILE {
  id          String   @id @default(uuid())
  reformId    String
  fileName    String
  filePath    String
  uploadedBy  String
  uploadedAt  String

  reform      ZFI_ASSET_REFORM @relation(fields: [reformId], references: [id])
}
```

* 도면, 작업서, 결과 보고서 등 리폼 관련 자료 저장용

---

## \[4. 코드 기준 항목]

| 필드             | 코드 그룹           | 예시 코드                             |
| -------------- | --------------- | --------------------------------- |
| `reformReason` | `REFORM_REASON` | DESIGN\_CHANGE, FUNCTION\_UPGRADE |
| `reformType`   | `REFORM_TYPE`   | COMPOSITE, SPLIT, REDESIGN        |

---

## \[5. 처리 기준 및 흐름]

| 처리 단계     | 필드 변화                                  |
| --------- | -------------------------------------- |
| 리폼 등록 시   | 기존 자산 상태 → `REFORMED`                  |
| 신규 자산 등록  | `ZFI_ASSET_MASTER`에 별도 등록, 새로운 RFID 부여 |
| 결과 이미지 등록 | `imageUrl` 필드에 썸네일 경로 저장               |
| 첨부파일 연결   | `ZFI_ASSET_REFORM_FILE`로 연결되어 자료 증빙 가능 |

---

## \[6. 확장 고려 사항]

* 리폼 유형이 COMPOSITE 또는 SPLIT인 경우 자산 다건 연계 테이블 `ZFI_ASSET_COMPOSITE` 확장 가능
* 리폼 상세 작업 단계 기록용 `ZFI_ASSET_REFORM_LOG` 별도 테이블 구성 가능
* 리폼 완료 후 이미지 자동 캡처 또는 업로드 기능 연동 가능 (웹캠, 사진 등)

---

## \[7. 제한 사항]

* SAP 자산번호, SAP 전표 연동 관련 필드는 제외 (별도 연동 구조에서 관리)
* 자산 마스터는 신규 자산 기준으로 별도 기록되며, 기존 자산은 수정 불가

---

