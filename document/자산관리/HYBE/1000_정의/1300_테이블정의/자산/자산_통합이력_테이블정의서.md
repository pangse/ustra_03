````md
# 문서명: ZFI_ASSET_LOG_테이블정의서.md
- 작성일: 2025-05-23
- 작성자: 송영근
- 내  용: 자산의 모든 행위(등록, 이동, 대여, 수선, 리폼, 폐기, 자동 감지 등)를 통합 기록하고 분석, 감사, 상태 추적 기반으로 활용하는 자산 통합 이력 테이블 정의서

---

## [1. 테이블명 및 목적]

- 테이블명: `ZFI_ASSET_LOG`
- 목적: 자산 단위로 발생한 모든 이벤트(행위)를 통합하여 기록하고,  
  상태 변화, 사용자 처리, 자동 감지, 연계 테이블을 추적 가능한 형태로 저장하여  
  전체 이력 분석, 알림 트리거, 감사 및 보고서 생성을 가능하게 함

---

## [2. 테이블 구조 (Prisma 기준)]

```prisma
model ZFI_ASSET_LOG {
  id           String   @id @default(uuid())        // 로그 ID
  assetId      String                               // 대상 자산 ID
  logType      String                               // 로그 유형 (MOVE, GPS, REPAIR, etc.)
  refType      String?                              // 참조 테이블 (예: ZFI_ASSET_REPAIR)
  refId        String?                              // 참조 ID (PK)
  description  String?                              // 상세 내용
  source       String                               // 등록 출처: MANUAL, AUTO
  changedBy    String                               // 수행자 ID (ZCM_USER.userId or SYSTEM)
  changedAt    String                               // 이력 발생 시각
  createdAt    String
}
````

---

## \[3. 연관 테이블 관계]

| 필드              | 참조 테이블             | 설명                                                                                    |
| --------------- | ------------------ | ------------------------------------------------------------------------------------- |
| assetId         | `ZFI_ASSET_MASTER` | 대상 자산                                                                                 |
| refType + refId | 다중 참조              | `ZFI_ASSET_RENT`, `ZFI_ASSET_REPAIR`, `ZFI_ASSET_REFORM`, `ZFI_ASSET_POSITION_LOG`, 등 |
| changedBy       | `ZCM_USER.userId`  | 행위 담당자 또는 시스템                                                                         |

---

## \[4. 로그 유형 코드 예시 (`logType`)]

| 코드       | 설명                               |
| -------- | -------------------------------- |
| REGISTER | 최초 등록                            |
| MOVE     | 이동 등록 (`ZFI_ASSET_MOVEMENT`)     |
| GPS      | 위치 감지 (`ZFI_ASSET_POSITION_LOG`) |
| RENT     | 대여 등록 (`ZFI_ASSET_RENT`)         |
| RETURN   | 반납 완료                            |
| REPAIR   | 수선 처리 (`ZFI_ASSET_REPAIR`)       |
| REFORM   | 리폼 완료 (`ZFI_ASSET_REFORM`)       |
| DISPOSE  | 자산 폐기 처리                         |

---

## \[5. 예시 기록]

| logType | source | changedBy | 설명            |
| ------- | ------ | --------- | ------------- |
| MOVE    | MANUAL | kim001    | 물류센터로 이동 등록   |
| GPS     | AUTO   | SYSTEM    | BLE 게이트 통과 감지 |
| REPAIR  | MANUAL | hong003   | 외부 수리 완료 처리됨  |
| DISPOSE | MANUAL | admin     | 자산 폐기 승인 처리   |

---

## \[6. 활용 목적]

* 자산 이력 통합 조회 화면 구성
* KPI 분석 (예: 수선 발생률, 이동 횟수)
* 경고 트리거 기반 설정 (예: 대여 후 30일 이내 미반납)
* 역할 변경 및 상태변화 정합성 검증용 감사 데이터

---

## \[7. 관리 기준]

* 이력은 변경/삭제 불가
* 시스템 자동 로그는 `changedBy = SYSTEM`, `source = AUTO`
* 모든 이력은 `changedAt DESC` 기준으로 정렬 가능해야 함

---

## \[8. 확장 고려 사항]

* `location` 또는 `statusAfter` 필드 확장 가능
* 사용자 정의 필터 (`logTag`) 기반 이력 분류
* 자산별 PDF 리포트 자동 출력용 View 구성

---

```
```
