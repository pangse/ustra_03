````md
# 문서명: ZFI_ASSET_REFORM_테이블정의서.md (리폼 유형 및 로그 확장 버전)
- 최종 수정일: 2025-05-23
- 작성자: 송영근
- 내  용: 자산 리폼 처리 시 COMPOSITE(병합형) 리폼 유형과 리폼 단계별 로그를 포함하여 다건-일건, 절차적 흐름, 책임자 추적이 가능한 리폼 이력 테이블 확장 정의서

---

## [1. 리폼 유형 확장 설명]

### 리폼 유형 분류 (`REFORM_TYPE`)

| 코드 | 설명 |
|------|------|
| SIMPLE | 단순 디자인 변경 또는 기능 보완 |
| COMPOSITE | 두 개 이상의 자산을 하나로 병합 |
| SPLIT | 하나의 자산을 여러 개로 분할 |
| REDESIGN | 외형 중심 리디자인 |
| FUNCTIONAL | 내부 기능 업그레이드

---

## [2. 다건 자산 병합 구조: `ZFI_ASSET_COMPOSITE`]

```prisma
model ZFI_ASSET_COMPOSITE {
  id              String   @id @default(uuid())       // 고유 식별자
  reformId        String                               // 리폼 이력 ID (ZFI_ASSET_REFORM.id)
  sourceAssetId   String                               // 병합 대상 자산 ID
  createdAt       String
}
````

* `ZFI_ASSET_REFORM.newAssetId`는 최종 생성된 하나의 자산
* `ZFI_ASSET_COMPOSITE.sourceAssetId[]`는 병합된 기존 자산 목록
* 리폼 유형이 `COMPOSITE`일 경우에만 사용됨
* 기존 `ZFI_ASSET_REFORM.sourceAssetId`는 주자산 기준으로 유지

---

## \[3. 리폼 진행 로그: `ZFI_ASSET_REFORM_LOG`]

```prisma
model ZFI_ASSET_REFORM_LOG {
  id          String   @id @default(uuid())
  reformId    String                              // ZFI_ASSET_REFORM.id
  step        String                              // 리폼 단계 (예: DESIGN, CUTTING, SEWING, FINISH)
  description String?                             // 단계 설명
  handlerId   String                              // 수행자 (ZCM_USER.userId)
  status      String                              // 단계 상태 (IN_PROGRESS, COMPLETED, HOLD)
  loggedAt    String                              // 작업 일시
}
```

* 리폼 절차를 단계별로 분해하여 진행 상황을 추적
* 상태는 진행중(IN\_PROGRESS), 완료(COMPLETED), 보류(HOLD) 등 관리
* `handlerId` 기준으로 작업 책임자 기록 가능

---

## \[4. 전체 구조 관계도]

```txt
ZFI_ASSET_REFORM
 ├─ newAssetId → 신규 자산 (ZFI_ASSET_MASTER)
 ├─ sourceAssetId → 주 대상 자산
 ├─ ZFI_ASSET_COMPOSITE (COMPOSITE 유형만)
 │    └─ sourceAssetId[] → 병합 대상 자산 리스트
 └─ ZFI_ASSET_REFORM_LOG → 리폼 단계별 이력
```

---

## \[5. 처리 흐름 예시: COMPOSITE 리폼]

1. 리폼 요청 등록 (sourceAssetId = A)
2. 병합 대상 추가: B, C → `ZFI_ASSET_COMPOSITE`에 등록
3. 신규 자산 생성 → D (newAssetId)
4. 리폼 이력 저장 → A + B + C → D
5. 리폼 단계별 로그 작성 (디자인, 자재 결합, 완성 등)

---

## \[6. 관리 기준]

* COMPOSITE 유형일 경우, `ZFI_ASSET_COMPOSITE`에 최소 2건 이상 등록 필수
* 리폼 로그는 모든 유형에서 사용 가능 (단계별 기록이 필요할 경우)
* 리폼 유형은 `ZCM_CODE_VALUE`에서 `codeGroupId = REFORM_TYPE`으로 관리

---

```
```
