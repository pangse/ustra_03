# 문서명: ZCM_USER_ROLE_LOG_테이블정의서.md
- 작성일: 2025-05-23
- 작성자: 송영근
- 내  용: 자산관리 시스템에서 사용자에게 역할(Role)이 부여되거나 회수된 이력을 기록하고, 감사 및 권한 변경 근거로 활용하기 위한 역할 변경 이력 테이블 정의서

---

## [1. 테이블명 및 목적]

- 테이블명: `ZCM_USER_ROLE_LOG`
- 목적: 사용자에게 역할이 변경(부여/회수)된 이력을 시간순으로 저장하고,  
        권한 변경의 투명성, 감사 추적, 보안 정책 준수 여부를 확인하는 기준 데이터를 제공

---

## [2. 테이블 구조 (Prisma 기준)]

```prisma
model ZCM_USER_ROLE_LOG {
  id           String   @id @default(uuid())    // 이력 고유 ID
  userId       String                            // 대상 사용자 ID (ZCM_USER.userId)
  roleId       String                            // 대상 역할 ID (ZCM_ROLE.id)
  action       String                            // ASSIGN 또는 REVOKE
  reason       String?                           // 변경 사유
  changedBy    String                            // 역할 변경 수행자 ID (ZCM_USER.userId or SYSTEM)
  changedAt    String                            // 변경 일시 (ISO8601)
}
````

---

## \[3. 연관 테이블 관계]

| 필드        | 참조 테이블     | 설명                    |
| --------- | ---------- | --------------------- |
| userId    | `ZCM_USER` | 대상 사용자                |
| roleId    | `ZCM_ROLE` | 대상 역할                 |
| changedBy | `ZCM_USER` | 변경 수행자 (`SYSTEM`도 가능) |

---

## \[4. 이력 관리 기준]

* 모든 레코드는 삭제/수정 불가 (추가만 가능)
* `action`은 ENUM 형태로 `ASSIGN`, `REVOKE` 중 하나
* `reason`은 사용자 직접 입력 또는 시스템 사유 자동 생성
* 자동 회수(`자동 만료`, `조직 이동`)도 시스템 기록으로 남겨야 함

---

## \[5. 활용 예시]

| userId | roleId         | action | reason      | changedBy | changedAt            |
| ------ | -------------- | ------ | ----------- | --------- | -------------------- |
| kim001 | ROLE\_USER     | ASSIGN | 신규 등록       | admin     | 2025-05-22T09:10:00Z |
| kim001 | ROLE\_USER     | REVOKE | 조직 이동       | SYSTEM    | 2025-05-23T08:00:00Z |
| kim001 | ROLE\_APPROVER | ASSIGN | 승인 권한 부여 요청 | admin     | 2025-05-23T09:00:00Z |

---

## \[6. 확장 고려 사항]

* `sourceEvent` 필드 추가 가능 (예: "조직변경", "시스템정책", "수동지정")
* `validFrom`, `validTo` 필드를 기반으로 자동화된 역할 종료 시 로그 자동 생성
* 알림 연계 가능 (`역할 변경 알림 → 사용자 / 관리자 발송`)

---

```

→ 이어서 다음 정의서인 `첨부파일_정의서.md`로 넘어갈게. 진행할까?
```
