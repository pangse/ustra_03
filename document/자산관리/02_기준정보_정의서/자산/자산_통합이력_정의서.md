# 문서명: 자산통합이력_정의서.md
- 작성일: 2025-05-23
- 작성자: 송영근
- 내  용: 자산의 전 생애주기 동안 발생하는 모든 행위(이동, 대여, 수선, 리폼, 폐기, 위치기반 감지 등)를 통합하여 하나의 흐름으로 추적하고 관리하기 위한 통합 이력 정의서

---

## [1. 정의]

**자산통합이력(Asset Unified History)**은 자산의 등록부터 이동, 대여, 수선, 리폼, 폐기,  
그리고 실시간 위치 기반 감지까지 모든 활동 이력을 **하나의 로그 체계로 통합**하여 기록하는 구조이다.  
이는 자산의 **생애주기 기반 감사, 경고, 상태 예측, 사용 분석, 이력 보고서 자동화**에 활용된다.

---

## [2. 연동 대상 로그 테이블 목록]

| 구분 | 테이블명 | 설명 |
|------|----------|------|
| 물리적 이동 | `ZFI_ASSET_MOVEMENT` | 사용자가 직접 등록한 이동 |
| 위치기반 자동감지 | `ZFI_ASSET_POSITION_LOG` | RFID, GPS, BLE 기반 자동 감지 이동 |
| 대여 | `ZFI_ASSET_RENT` | 자산 대여/회수 요청 및 상태 |
| 수선 | `ZFI_ASSET_REPAIR` | 수선 요청, 결과, 비용 기록 |
| 리폼 | `ZFI_ASSET_REFORM` | 기존 자산 → 신규 자산 전환 |
| 폐기 | (상태변경) | `assetStatus = DISPOSED` 처리 시점 기록 |

---

## [3. 통합 로그 테이블 개요: `ZFI_ASSET_LOG`]

| 필드명 | 설명 |
|--------|------|
| id | 로그 고유 ID |
| assetId | 자산 ID (ZFI_ASSET_MASTER) |
| logType | 로그 유형 (MOVE, RENT, GPS, REPAIR, REFORM, DISPOSE) |
| refType | 참조 테이블명 (예: ZFI_ASSET_REPAIR) |
| refId | 참조 PK |
| description | 상세 설명 |
| changedBy | 사용자 ID 또는 SYSTEM |
| changedAt | 변경 시각 |
| source | MANUAL / AUTO (등록 방식) |

---

## [4. 로그 분류 및 적용 기준]

| logType | refType | 등록 시점 | source |
|---------|---------|------------|--------|
| MOVE | ZFI_ASSET_MOVEMENT | 사용자가 이동등록 | MANUAL |
| GPS | ZFI_ASSET_POSITION_LOG | 위치자동감지 | AUTO |
| RENT | ZFI_ASSET_RENT | 대여/반납 | MANUAL |
| REPAIR | ZFI_ASSET_REPAIR | 수선 처리 | MANUAL |
| REFORM | ZFI_ASSET_REFORM | 리폼 완료 | MANUAL |
| DISPOSE | 없음 | 상태 변경 시 | MANUAL or AUTO |

---

## [5. 흐름 예시]

```txt
자산 A001
 ├─ [2025-04-01] 등록됨
 ├─ [04-03] 이동 (수동등록)
 ├─ [04-03] GPS 감지 (서울본사)
 ├─ [04-10] 수선 시작
 ├─ [04-15] 수선 완료
 ├─ [04-20] 리폼 처리됨 → A045 신규 등록
 └─ [04-21] 자산상태: REFORMED
````

---

## \[6. 활용 목적]

* 자산 단위 통합 이력 조회 화면 구성
* 상태별 필터링/분석 (예: REPAIR → REFORM 비율)
* 관리자 감사 대응 보고서 자동 출력
* 위치/이력 기반 경고 시스템 트리거

---

## \[7. 확장 고려 사항]

* 이력 기반 사용자별 책임 추적 (handlerId → user)
* 상태별 체류 시간 자동 계산 (예: 평균 수선일수)
* PDF 리포트 자동 생성
* SAP 동기화를 위한 이력 전송 트랜잭션 로그 구성

---
