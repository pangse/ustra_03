````md
# 문서명: ZFI_ASSET_REPAIR_테이블정의서.md (확장 버전)
- 수정일: 2025-05-23
- 작성자: 송영근
- 내  용: 자산 수선 이력에 외부 수리기관 정보 및 첨부파일 연결 구조를 포함한 확장형 수선 이력 테이블 정의서

---

## [1. 테이블명 및 목적]

- 테이블명: `ZFI_ASSET_REPAIR`
- 목적: 자산 수선 요청부터 완료까지의 전 과정과 외부 수리기관, 수선비용, 리폼 전환 가능성을 기록하며,  
        수선 첨부파일과 외부 업체 정보도 연계하여 실무 중심 수선 이력을 구성

---

## [2. 테이블 구조 (Prisma 기준)]

```prisma
model ZFI_ASSET_REPAIR {
  id              String   @id @default(uuid())     // 수선 이력 ID
  assetId         String                              // 대상 자산 ID (ZFI_ASSET_MASTER.id)
  orgId           String                              // 요청 조직 ID
  requesterId     String                              // 수선 요청자 ID
  repairType      String                              // 수선 유형 코드
  repairStatus    String                              // 수선 상태 코드
  requestDate     String                              // 수선 요청일
  repairStartDate String?                             // 수선 시작일
  repairEndDate   String?                             // 수선 완료일
  vendorId        String?                             // 외부 수리기관 ID (ZFI_VENDOR.vendorId)
  cost            Float?                              // 수선 비용
  description     String?                             // 수선 내역 요약
  isReformTarget  Boolean  @default(false)            // 리폼 대상 여부
  createdBy       String
  createdAt       String
  updatedBy       String?
  updatedAt       String?

  attachments     ZFI_ASSET_REPAIR_FILE[]
  vendor          ZFI_VENDOR? @relation(fields: [vendorId], references: [vendorId])
}
````

---

## \[3. 연계 테이블 ①: 수리 첨부파일]

```prisma
model ZFI_ASSET_REPAIR_FILE {
  id          String   @id @default(uuid())
  repairId    String                              // FK to ZFI_ASSET_REPAIR.id
  fileName    String
  filePath    String
  uploadedBy  String                              // ZCM_USER.userId
  uploadedAt  String

  repair      ZFI_ASSET_REPAIR @relation(fields: [repairId], references: [id])
}
```

* 수선 요청 시 요청서, 고장 사진, 완료 증빙 등의 파일 저장
* 파일은 서버 저장 또는 외부 S3/Blob URL 기반으로도 설계 가능

---

## \[4. 연계 테이블 ②: 외부 수리업체 마스터]

```prisma
model ZFI_VENDOR {
  vendorId   String   @id @default(uuid())
  vendorName String
  contact    String?
  phone      String?
  email      String?
  address    String?
  isActive   Boolean  @default(true)
  createdBy  String
  createdAt  String
}
```

* 수리 요청 시 등록된 업체에서 선택 가능
* 미등록 업체일 경우 추가 등록 가능
* 향후 수선 분석 통계에 활용 가능

---

## \[5. 트리거/연동 처리 재정의]

| 조건                                 | 후속 처리                           |
| ---------------------------------- | ------------------------------- |
| 수선 완료 (`repairStatus = COMPLETED`) | 자산 상태 → `ACTIVE` 또는 `REFORMED`  |
| 리폼 대상 (`isReformTarget = true`)    | `ZFI_ASSET_REFORM` 테이블로 이관 유도   |
| 첨부 등록                              | `ZFI_ASSET_REPAIR_FILE` 생성 및 연결 |
| vendorId 지정 시                      | `ZFI_VENDOR` 정보 자동 표시           |

---

## \[6. 확장 고려]

* 첨부파일 MIME 타입별 분류
* 파일 다운로드/접근 로그(`ZFI_FILE_LOG`) 별도 설계
* 수리 완료 시 SMS 또는 메일 알림 (대여 상태 복귀 유도)

---

```
```
