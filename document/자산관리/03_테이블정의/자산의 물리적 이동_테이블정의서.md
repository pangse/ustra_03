````md
# 문서명: ZFI_ASSET_MOVEMENT_테이블정의서.md
- 수정일: 2025-05-23
- 작성자: 송영근
- 내  용: 자산의 물리적 위치 이동 이력을 기록하고, 자산 상태 및 위치를 자동 갱신하며 조직·이동 목적과 연동되는 자산 이동 이력 테이블 정의서

---

## [1. 테이블명 및 목적]

- 테이블명: `ZFI_ASSET_MOVEMENT`
- 목적: 자산의 위치가 변경된 모든 내역을 기록하고, 이동 목적과 처리 담당자를 명확히 하며,  
        자산 마스터(`ZFI_ASSET_MASTER`)의 `location` 필드를 자동으로 갱신하기 위한 트리거 기반 구조

---

## [2. 테이블 구조 (Prisma 기준)]

```prisma
model ZFI_ASSET_MOVEMENT {
  id             String   @id @default(uuid())     // 이동 이력 ID
  assetId        String                              // 이동 대상 자산 ID (ZFI_ASSET_MASTER.id)
  fromLocation   String                              // 이동 전 위치 (공통코드: LOCATION)
  toLocation     String                              // 이동 후 위치 (공통코드: LOCATION)
  fromOrgId      String                              // 이동 전 조직 ID (ZCM_ORG_UNIT.orgId)
  toOrgId        String                              // 이동 후 조직 ID (ZCM_ORG_UNIT.orgId)
  locationType   String                              // 위치 유형 (공통코드: LOCATION_TYPE)
  movePurpose    String                              // 이동 목적 (공통코드: MOVE_PURPOSE)
  moveDate       String                              // 이동일자
  reason         String?                             // 이동 사유
  handler        String                              // 실행 담당자 (ZCM_USER.userId)
  createdBy      String                              // 등록자 (ZCM_USER.userId)
  createdAt      String
}
````

---

## \[3. 연관 테이블 관계]

| 필드                                  | 참조 테이블             | 설명           |
| ----------------------------------- | ------------------ | ------------ |
| assetId                             | `ZFI_ASSET_MASTER` | 이동 대상 자산     |
| handler / createdBy                 | `ZCM_USER`         | 실행 담당자 및 등록자 |
| fromOrgId / toOrgId                 | `ZCM_ORG_UNIT`     | 조직 기준 이동 흐름  |
| locationType, movePurpose, location | `ZCM_CODE_VALUE`   | 공통코드 기반 필드   |

---

## \[4. 트리거 및 자동 처리]

| 변경 이벤트               | 후속 처리 항목                                      |
| -------------------- | --------------------------------------------- |
| 이동 등록 시              | `ZFI_ASSET_MASTER.location` → `toLocation` 갱신 |
| 이동 목적이 RETURN일 경우    | 자산 상태 → `ACTIVE` 복귀                           |
| 이동 목적이 REFORM일 경우    | 자산 상태 → `REFORMED` 처리 가능                      |
| `ZFI_ASSET_LOG` (예정) | 이동 이력 추가 로그 기록                                |

---

## \[5. 관리 기준]

* 이동 기록은 삭제 불가, 수정은 제한적으로 허용
* 자산 1건은 여러 이동 이력을 가질 수 있으며 `moveDate` 기준으로 최신 상태 결정
* 외부 이동(공연, 전시 등)은 조직 외부코드와 함께 SAP 연계 가능

---

## \[6. 확장 고려 사항]

* 이동별 첨부파일(`ZFI_ASSET_MOVE_FILE`) 연결 가능
* GPS, BLE 기반 자동위치 업데이트 연동 지원 가능
* SAP 자산조정 전표 인터페이스 구성 가능

---

```

다음은 자산 대여 이력 테이블 `ZFI_ASSET_RENT`로 넘어갈게.  
계속할까?
```
